import{w as k}from"./with-props-BiQABcLS.js";import{r as n,q as E,n as t}from"./chunk-AYJ5UCUI-D02hIfpQ.js";import{a as r}from"./index-xsH4HHeE.js";const T=()=>{const[a,c]=n.useState([]),[l,h]=n.useState(""),[b,p]=n.useState(null),[i,d]=n.useState(""),j=E(),[N,f]=n.useState(""),[o,u]=n.useState({phone:"",city:""}),[x,m]=n.useState(!1);n.useEffect(()=>{r.get("http://localhost:5000/api/tasks",{withCredentials:!0}).then(e=>{c(e.data.tasks),f(e.data.user),u(e.data.contact||{phone:"",city:""})}).catch(e=>{e.response.status===401?console.error("User not logged in or session expired"):console.error("خطا در دریافت اطلاعات",e)})},[]);const g=()=>{l.trim()&&r.post("http://localhost:5000/api/add",{description:l},{withCredentials:!0}).then(e=>{c([...a,{id:e.data.task_id,description:l}]),h("")}).catch(e=>console.error("خطا در افزودن تسک",e))},C=e=>{r.post("http://localhost:5000/api/remove",{id:e},{withCredentials:!0}).then(()=>c(a.filter(s=>s.id!==e))).catch(s=>console.error("خطا در حذف تسک",s))},w=e=>{p(e.id),d(e.description)},v=()=>{p(null),d("")},y=e=>{i.trim()&&r.post("http://localhost:5000/api/edit",{id:e,description:i},{withCredentials:!0}).then(()=>{c(a.map(s=>s.id===e?{...s,description:i}:s)),p(null),d("")}).catch(s=>console.error("خطا در ویرایش تسک",s))},S=()=>{!o.phone||!o.city||r.post("http://localhost:5000/api/edit-contact",o,{withCredentials:!0}).then(()=>{m(!1),alert("اطلاعات تماس ذخیره شد")}).catch(e=>console.error("خطا در ذخیره اطلاعات تماس",e))};return t.jsxs("div",{className:"p-4 max-w-xl mx-auto",children:[t.jsxs("div",{className:"flex justify-between mb-4",children:[t.jsx("button",{onClick:()=>j("/"),className:"w-30 bg-red-600 text-white py-2 rounded self-center mt-1.5 cursor-pointer",children:"خروج"}),t.jsx("h1",{className:"text-xl",children:"تسک‌های من"}),t.jsx("button",{onClick:()=>m(!x),className:"bg-blue-500 text-white px-3 py-1 rounded cursor-pointer",children:N})]}),x&&t.jsxs("div",{className:"border rounded p-3 mb-4",children:[t.jsx("h2",{className:"mb-2 font-bold",children:"ویرایش اطلاعات تماس"}),t.jsx("input",{type:"text",placeholder:"شماره تماس",value:o.phone,onChange:e=>u({...o,phone:e.target.value}),className:"w-full mb-2 border px-2 py-1 rounded"}),t.jsx("input",{type:"text",placeholder:"شهر",value:o.city,onChange:e=>u({...o,city:e.target.value}),className:"w-full mb-2 border px-2 py-1 rounded"}),t.jsx("button",{onClick:S,className:"bg-green-500 text-white px-4 py-1 rounded cursor-pointer",children:"ذخیره اطلاعات تماس"})]}),t.jsxs("div",{className:"flex mb-4",children:[t.jsx("input",{type:"text",value:l,onChange:e=>h(e.target.value),className:"flex-1 border px-2 py-1 rounded",placeholder:"تسک جدید"}),t.jsx("button",{onClick:g,className:"ml-2 px-4 py-1 bg-green-500 text-white rounded cursor-pointer",children:"اضافه"})]}),t.jsx("ul",{children:a.map(e=>t.jsx("li",{className:"flex justify-between items-center mb-2",children:b===e.id?t.jsxs(t.Fragment,{children:[t.jsx("input",{value:i,onChange:s=>d(s.target.value),className:"flex-1 border px-2 py-1 rounded"}),t.jsxs("div",{className:"ml-2 space-x-2",children:[t.jsx("button",{onClick:()=>y(e.id),className:"text-blue-600 cursor-pointer",children:"ذخیره"}),t.jsx("button",{onClick:v,className:"text-gray-500 cursor-pointer",children:"لغو"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:e.description}),t.jsxs("div",{className:"space-x-2",children:[t.jsx("button",{onClick:()=>w(e),className:"text-blue-600 cursor-pointer",children:"ویرایش"}),t.jsx("button",{onClick:()=>C(e.id),className:"text-red-600 cursor-pointer",children:"حذف"})]})]})},e.id))})]})},U=k(T);export{U as default};
